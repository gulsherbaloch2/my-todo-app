# API Contracts: Todo Application Backend

## Endpoint: GET /api/{user_id}/tasks

### Description
Retrieve all tasks for a specific user.

### Request
- **Method**: GET
- **Path**: `/api/{user_id}/tasks`
- **Headers**: 
  - `Authorization: Bearer {jwt_token}`
- **Parameters**:
  - `user_id` (path): User ID from URL must match JWT user ID
- **Body**: None

### Response
- **Success (200)**:
  ```json
  {
    "tasks": [
      {
        "id": 1,
        "user_id": "user123",
        "title": "Sample task",
        "description": "Task description",
        "completed": false,
        "created_at": "2023-01-01T10:00:00Z",
        "updated_at": "2023-01-01T10:00:00Z"
      }
    ]
  }
  ```
- **Unauthorized (401)**:
  ```json
  {
    "detail": "Not authenticated"
  }
  ```
- **Forbidden (403)**:
  ```json
  {
    "detail": "Access forbidden: user_id mismatch"
  }
  ```

---

## Endpoint: POST /api/{user_id}/tasks

### Description
Create a new task for a specific user.

### Request
- **Method**: POST
- **Path**: `/api/{user_id}/tasks`
- **Headers**: 
  - `Authorization: Bearer {jwt_token}`
- **Parameters**:
  - `user_id` (path): User ID from URL must match JWT user ID
- **Body**:
  ```json
  {
    "title": "New task title",
    "description": "Task description (optional)",
    "completed": false
  }
  ```

### Response
- **Success (201)**:
  ```json
  {
    "id": 1,
    "user_id": "user123",
    "title": "New task title",
    "description": "Task description (optional)",
    "completed": false,
    "created_at": "2023-01-01T10:00:00Z",
    "updated_at": "2023-01-01T10:00:00Z"
  }
  ```
- **Bad Request (400)**:
  ```json
  {
    "detail": "Validation error: title is required and must be 1-200 characters"
  }
  ```
- **Unauthorized (401)**:
  ```json
  {
    "detail": "Not authenticated"
  }
  ```
- **Forbidden (403)**:
  ```json
  {
    "detail": "Access forbidden: user_id mismatch"
  }
  ```

---

## Endpoint: GET /api/{user_id}/tasks/{id}

### Description
Retrieve a specific task by ID for a user.

### Request
- **Method**: GET
- **Path**: `/api/{user_id}/tasks/{id}`
- **Headers**: 
  - `Authorization: Bearer {jwt_token}`
- **Parameters**:
  - `user_id` (path): User ID from URL must match JWT user ID
  - `id` (path): Task ID to retrieve
- **Body**: None

### Response
- **Success (200)**:
  ```json
  {
    "id": 1,
    "user_id": "user123",
    "title": "Sample task",
    "description": "Task description",
    "completed": false,
    "created_at": "2023-01-01T10:00:00Z",
    "updated_at": "2023-01-01T10:00:00Z"
  }
  ```
- **Not Found (404)**:
  ```json
  {
    "detail": "Task not found"
  }
  ```
- **Unauthorized (401)**:
  ```json
  {
    "detail": "Not authenticated"
  }
  ```
- **Forbidden (403)**:
  ```json
  {
    "detail": "Access forbidden: user_id mismatch"
  }
  ```

---

## Endpoint: PUT /api/{user_id}/tasks/{id}

### Description
Update an existing task for a user.

### Request
- **Method**: PUT
- **Path**: `/api/{user_id}/tasks/{id}`
- **Headers**: 
  - `Authorization: Bearer {jwt_token}`
- **Parameters**:
  - `user_id` (path): User ID from URL must match JWT user ID
  - `id` (path): Task ID to update
- **Body**:
  ```json
  {
    "title": "Updated task title",
    "description": "Updated task description",
    "completed": true
  }
  ```

### Response
- **Success (200)**:
  ```json
  {
    "id": 1,
    "user_id": "user123",
    "title": "Updated task title",
    "description": "Updated task description",
    "completed": true,
    "created_at": "2023-01-01T10:00:00Z",
    "updated_at": "2023-01-02T10:00:00Z"
  }
  ```
- **Bad Request (400)**:
  ```json
  {
    "detail": "Validation error: title is required and must be 1-200 characters"
  }
  ```
- **Not Found (404)**:
  ```json
  {
    "detail": "Task not found"
  }
  ```
- **Unauthorized (401)**:
  ```json
  {
    "detail": "Not authenticated"
  }
  ```
- **Forbidden (403)**:
  ```json
  {
    "detail": "Access forbidden: user_id mismatch"
  }
  ```

---

## Endpoint: DELETE /api/{user_id}/tasks/{id}

### Description
Delete a specific task for a user.

### Request
- **Method**: DELETE
- **Path**: `/api/{user_id}/tasks/{id}`
- **Headers**: 
  - `Authorization: Bearer {jwt_token}`
- **Parameters**:
  - `user_id` (path): User ID from URL must match JWT user ID
  - `id` (path): Task ID to delete
- **Body**: None

### Response
- **Success (204)**: No content
- **Not Found (404)**:
  ```json
  {
    "detail": "Task not found"
  }
  ```
- **Unauthorized (401)**:
  ```json
  {
    "detail": "Not authenticated"
  }
  ```
- **Forbidden (403)**:
  ```json
  {
    "detail": "Access forbidden: user_id mismatch"
  }
  ```

---

## Endpoint: PATCH /api/{user_id}/tasks/{id}/complete

### Description
Update the completion status of a specific task for a user.

### Request
- **Method**: PATCH
- **Path**: `/api/{user_id}/tasks/{id}/complete`
- **Headers**: 
  - `Authorization: Bearer {jwt_token}`
- **Parameters**:
  - `user_id` (path): User ID from URL must match JWT user ID
  - `id` (path): Task ID to update completion status
- **Body**:
  ```json
  {
    "completed": true
  }
  ```

### Response
- **Success (200)**:
  ```json
  {
    "id": 1,
    "user_id": "user123",
    "title": "Sample task",
    "description": "Task description",
    "completed": true,
    "created_at": "2023-01-01T10:00:00Z",
    "updated_at": "2023-01-02T10:00:00Z"
  }
  ```
- **Bad Request (400)**:
  ```json
  {
    "detail": "Validation error: completed field is required"
  }
  ```
- **Not Found (404)**:
  ```json
  {
    "detail": "Task not found"
  }
  ```
- **Unauthorized (401)**:
  ```json
  {
    "detail": "Not authenticated"
  }
  ```
- **Forbidden (403)**:
  ```json
  {
    "detail": "Access forbidden: user_id mismatch"
  }
  ```